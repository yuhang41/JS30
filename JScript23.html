<!DOCTYPE html>
<html>
  <head>
    <title>JScript23.html</title>
	
    <meta name="keywords" content="keyword1,keyword2,keyword3">
    <meta name="description" content="this is my page">
    <meta name="content-type" content="text/html; charset=UTF-8">
    <link rel="stylesheet" type="text/css" href="./JsCss/JsCss23.css">

  </head>
  
  <body>
    <div class="voiceinator">

      <h1>The Voiceinator 5000</h1>

      <select name="voice" id="voices">
        <option value="">Select A Voice</option>
      </select>

      <label for="rate">Rate:</label>
      <input name="rate" type="range" min="0" max="3" value="1" step="0.1">

      <label for="pitch">Pitch:</label>
      <input name="pitch" type="range" min="0" max="2" step="0.1">
      
      <textarea name="text">ÂêÑ‰ΩçÂ•ΩÂïä„ÄÇ üëç</textarea>
      
      <button id="stop">Stop!</button>
      <button id="speak">Speak</button>

    </div>
    <script type="text/javascript">
    	let utterance =new SpeechSynthesisUtterance();//Ë™ûÈü≥ÂêàÊàêÂô®
    	utterance.text=document.querySelector('[name="text"]').value;
    	
    	let voices =[];
    	let voicesDropdown =document.querySelector('[name="voice"]');
    	let speakButton = document.querySelector("#speak");
    	let stopButton = document.querySelector('#stop');
    	let options = document.querySelectorAll('[type="range"], [name="text"]');
    	
    	function populateVoice(){
    		//voiceschanged‰∫ã‰ª∂ÁúüËÅΩË™ûÈü≥ÔºåÁî®getVoices()ÂéªÂèñÂá∫‰æÜ
    		voices =this.getVoices();
    		
    		//ÊääÂèñÂá∫‰æÜÁöÑ voiceschanged ÊîæÂà∞ voicesDropdown (‰∏ãÊãâÈÅ∏ÂñÆ) 
    		voicesDropdown.innerHTML=voices
    		.filter(voice => voice.lang.includes("zh"))
    		.map(voice => `<option value="${voice.name}">${voice.name} (${voice.lang})</option>`)
    		.join("");    		
    	};
    	function setVoices(){ //ÈÅ∏ÊìáË™ûË®Ä
    		utterance.voice = voices.find(voice=>voice.name ===this.value);
    		toggle();
    	}
    	function setOption(){//Ë®≠ÂÆö Rate Ë∑ü Pitch
    		console.log(this.name,this.value);//this.name Â∞±ÊòØ Rate Ë∑ü PitchÔºåthis.value Â∞±ÊòØÊï∏ÂÄº
    					//ÈÄôË£°ÈÇÑÂè¶Â§ñÂÅµËÅΩ utterance.text Ôºåthis.name Â∞±ÊòØtextÔºåthis.value Â∞±ÊòØ‰Ω†ÊâÄÊâìÁöÑÊñáÂ≠ó
    		utterance[this.name] = this.value; //ÈÄôË£°ÂèØ‰ª•ÁúãÊàêÈÄôÊ®£ => utterance.Pitch = 1.5
    		toggle();
    	}
    	function toggle(startOver = true){//Êí•Êîæ
    		speechSynthesis.cancel();//Â∞áËÅ≤Èü≥ÂÖàÂÅúÊ≠¢
    		if(startOver)
    			speechSynthesis.speak(utterance);
    			
    	}
    	
    	speechSynthesis.addEventListener("voiceschanged",populateVoice);//voiceschanged‰∫ã‰ª∂ÂéªÂÅµËÅΩÊúâÂ§öÂ∞ëÂÄãË™ûÈü≥    	
    	voicesDropdown.addEventListener("change",setVoices);
    	speakButton.addEventListener("click",toggle);
    	stopButton.addEventListener("click",()=>toggle(false));
    	options.forEach(option=>option.addEventListener("change",setOption));
    </script>
  </body>
</html>
